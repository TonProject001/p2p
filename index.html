<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>จุดนัดพบ</title>
    <style>
        #map {
            width: 100%;
            height: 500px;
            border: 1px solid #ccc;
            position: relative;
        }
        .marker {
            position: absolute;
            width: 20px;
            height: 20px;
            background-color: red;
            border-radius: 50%;
            transform: translate(-50%, -50%);
        }
        .user1 { background-color: blue; }
        .user2 { background-color: green; }
    </style>
</head>
<body>
    <h1>ระบุจุดนัดพบ</h1>
    <div id="map"></div>
    <p>คลิกบนแผนที่เพื่อกำหนดตำแหน่งของคุณ</p>

    <!-- Firebase SDK -->
    <script src="https://www.gstatic.com/firebasejs/9.6.1/firebase-app.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.6.1/firebase-database.js"></script>

    <script>
        // ตั้งค่า Firebase
        const firebaseConfig = {
            apiKey: "AIzaSyC_VUDDpxMiRkLONjOganaRqvoi4q3Gnt8",
            authDomain: "meetingpointapp.firebaseapp.com",
            databaseURL: "https://meetingpointapp-default-rtdb.asia-southeast1.firebasedatabase.app",
            projectId: "meetingpointapp",
            storageBucket: "meetingpointapp.firebasestorage.app",
            messagingSenderId: "753839058602",
            appId: "1:753839058602:web:5ae71cc0c803de3c862ad3"
        };

        // Initialize Firebase
        const app = firebase.initializeApp(firebaseConfig);
        const database = firebase.database();

        const map = document.getElementById('map');
        let userMarker = null;

        // ฟังก์ชันเพิ่ม Marker ลงบนแผนที่
        function addMarker(x, y, className) {
            const marker = document.createElement('div');
            marker.className = `marker ${className}`;
            marker.style.left = `${x}px`;
            marker.style.top = `${y}px`;
            map.appendChild(marker);
            return marker;
        }

        // ฟังก์ชันลบ Marker เดิม (ถ้ามี)
        function removeMarker(marker) {
            if (marker && marker.parentNode) {
                marker.parentNode.removeChild(marker);
            }
        }

        // เมื่อคลิกบนแผนที่
        map.addEventListener('click', (event) => {
            const rect = map.getBoundingClientRect();
            const x = event.clientX - rect.left;
            const y = event.clientY - rect.top;

            // อัปเดตตำแหน่งของผู้ใช้ใน Firebase
            const userId = localStorage.getItem('userId') || `user${Math.random().toString(36).substr(2, 5)}`;
            localStorage.setItem('userId', userId);

            database.ref(`users/${userId}`).set({
                x: x,
                y: y
            });

            // อัปเดต Marker ของผู้ใช้เอง
            removeMarker(userMarker);
            userMarker = addMarker(x, y, 'user1');
        });

        // ดึงข้อมูลตำแหน่งจาก Firebase และแสดง Marker ของผู้ใช้อื่น
        database.ref('users').on('value', (snapshot) => {
            const users = snapshot.val();
            if (!users) return;

            // ลบ Marker เดิมทั้งหมด
            document.querySelectorAll('.marker:not(.user1)').forEach(marker => marker.remove());

            // เพิ่ม Marker สำหรับผู้ใช้อื่น
            for (const [userId, position] of Object.entries(users)) {
                if (userId !== localStorage.getItem('userId')) {
                    addMarker(position.x, position.y, 'user2');
                }
            }
        });
    </script>
</body>
</html>
